<script>
// ---------------- Sections ----------------
function showSection(section) {
  const sections = ['calls','units','bolos','arrests','warrants'];
  sections.forEach(s => document.getElementById(s).style.display = 'none');
  document.getElementById(section).style.display = 'block';
}

// ---------------- Data ----------------
let calls = [], units = [], bolos = [], arrests = [], warrants = [];
let idCounter = 1;

// ---------------- Calls ----------------
function renderCalls() {
  const tbody = document.querySelector('#callsTable tbody');
  tbody.innerHTML = '';
  calls.forEach(c => {
    tbody.innerHTML += `<tr>
      <td>${c.id}</td>
      <td>${c.type}</td>
      <td>${c.location}</td>
      <td>${c.status}</td>
      <td><input class="unitName" placeholder="Assign Unit"></td>
      <td><button onclick="deleteCall(${c.id})">Delete</button></td>
    </tr>`;
  });
}

function addCall() {
  const type = prompt("Call Type:");
  if(!type) return;
  const location = prompt("Location:");
  if(!location) return;
  calls.push({id: idCounter++, type, location, status: "Active"});
  renderCalls();
}

function deleteCall(id){
  calls = calls.filter(c=>c.id!==id);
  renderCalls();
}

// ---------------- Units ----------------
function renderUnits() {
  const tbody = document.querySelector('#unitsTable tbody');
  tbody.innerHTML = '';
  units.forEach(u => {
    tbody.innerHTML += `<tr>
      <td>${u.id}</td>
      <td>${u.name}</td>
      <td>${u.status}</td>
    </tr>`;
  });
}

function addUnit() {
  const name = prompt("Unit Name:");
  if(!name) return;
  units.push({id: idCounter++, name, status: "Available"});
  renderUnits();
}

// ---------------- BOLOs ----------------
function renderBolos() {
  const tbody = document.querySelector('#bolosTable tbody');
  tbody.innerHTML='';
  bolos.forEach(b=>{
    tbody.innerHTML+=`<tr>
      <td>${b.id}</td>
      <td>${b.description}</td>
      <td>${b.status}</td>
      <td><button onclick="deleteBolo(${b.id})">Delete</button></td>
    </tr>`;
  });
}

function addBolo() {
  const desc = prompt("BOLO Description:");
  if(!desc) return;
  bolos.push({id: idCounter++, description: desc, status:"Active"});
  renderBolos();
}

function deleteBolo(id){bolos=bolos.filter(b=>b.id!==id);renderBolos();}

// ---------------- Arrests ----------------
function renderArrests(){
  const tbody=document.querySelector('#arrestsTable tbody');
  tbody.innerHTML='';
  arrests.forEach(a=>{
    tbody.innerHTML+=`<tr>
      <td>${a.id}</td>
      <td>${a.name}</td>
      <td>${a.reason}</td>
      <td><button onclick="deleteArrest(${a.id})">Delete</button></td>
    </tr>`;
  });
}

function addArrest() {
  const name = prompt("Person Name:");
  if(!name) return;
  const reason = prompt("Reason:");
  if(!reason) return;
  arrests.push({id: idCounter++, name, reason});
  renderArrests();
}

function deleteArrest(id){arrests=arrests.filter(a=>a.id!==id);renderArrests();}

// ---------------- Warrants ----------------
function renderWarrants(){
  const tbody=document.querySelector('#warrantsTable tbody');
  tbody.innerHTML='';
  warrants.forEach(w=>{
    tbody.innerHTML+=`<tr>
      <td>${w.id}</td>
      <td>${w.name}</td>
      <td>${w.reason}</td>
      <td><button onclick="deleteWarrant(${w.id})">Delete</button></td>
    </tr>`;
  });
}

function addWarrant() {
  const name = prompt("Person Name:");
  if(!name) return;
  const reason = prompt("Reason:");
  if(!reason) return;
  warrants.push({id: idCounter++, name, reason});
  renderWarrants();
}

function deleteWarrant(id){warrants=warrants.filter(w=>w.id!==id);renderWarrants();}

// ---------------- Chat ----------------
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const chatSend = document.getElementById("chatSend");

// Assign random username per tab
const username = "Officer" + Math.floor(Math.random() * 1000);

// Load existing messages
function loadMessages() {
  const messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
  chatMessages.innerHTML = '';
  messages.forEach(m => addMessageToDOM(m.sender, m.text));
}

// Add message to DOM
function addMessageToDOM(sender, text) {
  const message = document.createElement("div");
  message.classList.add("message");
  if(sender === username) message.classList.add("user");
  message.textContent = `${sender}: ${text}`;
  chatMessages.appendChild(message);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Send message
chatSend.addEventListener("click", () => {
  const text = chatInput.value.trim();
  if(!text) return;

  const messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
  const msg = {sender: username, text, timestamp: Date.now()};
  messages.push(msg);
  localStorage.setItem("chatMessages", JSON.stringify(messages));
  addMessageToDOM(username, text);
  chatInput.value = "";
});

// Enter key
chatInput.addEventListener("keydown", (e)=>{
  if(e.key==="Enter") chatSend.click();
});

// Listen for other tabs
window.addEventListener("storage", (e) => {
  if(e.key === "chatMessages") loadMessages();
});

// Initial load
window.addEventListener("load", () => loadMessages());
</script>
