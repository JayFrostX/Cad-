<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Police CAD</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
  body { margin: 0; font-family: Arial, sans-serif; display: flex; height: 100vh; }
  #sidebar { width: 300px; background: #2c3e50; color: white; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
  #sidebar h2 { margin-top: 0; }
  #sidebar button { margin: 5px 0; padding: 10px; border: none; background: #34495e; color: white; cursor: pointer; }
  #sidebar button:hover { background: #1abc9c; }
  #main { flex: 1; display: flex; flex-direction: column; }
  #calls, #units, #bolos { flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #ccc; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
  #map { flex: 2; }
  input.unitName { width: 80%; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Police CAD</h2>
  <button onclick="showSection('calls')">Calls</button>
  <button onclick="showSection('units')">Units</button>
  <button onclick="showSection('bolos')">BOLOs</button>
</div>

<div id="main">
  <div id="calls">
    <h3>Active Calls</h3>
    <button onclick="addCall()">Add Call</button>
    <table id="callsTable">
      <thead><tr><th>ID</th><th>Type</th><th>Location</th><th>Status</th><th>Assign</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="units" style="display:none;">
    <h3>Units</h3>
    <button onclick="addUnit()">Add Unit</button>
    <table id="unitsTable">
      <thead><tr><th>ID</th><th>Name</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="bolos" style="display:none;">
    <h3>BOLOs / Warrants</h3>
    <button onclick="addBolo()">Add BOLO</button>
    <table id="bolosTable">
      <thead><tr><th>ID</th><th>Description</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="map"></div>
</div>

<script>
// Sections
function showSection(section) {
  document.getElementById('calls').style.display = 'none';
  document.getElementById('units').style.display = 'none';
  document.getElementById('bolos').style.display = 'none';
  document.getElementById(section).style.display = 'block';
}

// Sample data
let calls = [];
let units = [
  {id: 1, name: 'Unit 1', status: 'Available', lat: 39.7684, lng: -86.1581, marker: null},
  {id: 2, name: 'Unit 2', status: 'Available', lat: 39.7700, lng: -86.1600, marker: null}
];
let bolos = [];

// Map setup
const map = L.map('map').setView([39.7684, -86.1581], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenStreetMap contributors' }).addTo(map);

// Functions
function addCall() {
  const type = prompt("Enter call type (e.g., Traffic Stop, 911):");
  const location = prompt("Enter location (address or coords as 'lat,lng'):");
  if(!type || !location) return;
  let lat = 39.7684, lng = -86.1581;
  if(location.includes(',')) {
    const parts = location.split(',');
    lat = parseFloat(parts[0]);
    lng = parseFloat(parts[1]);
  }
  const id = calls.length + 1;
  const call = {id, type, location, status: 'Dispatched', assigned: '', lat, lng, marker: null};
  calls.push(call);
  // Add map marker
  call.marker = L.marker([lat, lng]).addTo(map).bindPopup(`Call #${id}: ${type}`);
  renderCalls();
}

function addUnit() {
  const name = prompt("Enter unit name:");
  if(!name) return;
  const id = units.length + 1;
  const lat = 39.7684 + Math.random()/100; // random nearby for demo
  const lng = -86.1581 + Math.random()/100;
  const marker = L.marker([lat, lng], {icon: L.icon({iconUrl: 'https://cdn-icons-png.flaticon.com/512/149/149071.png', iconSize: [25,25]})})
                   .addTo(map).bindPopup(`Unit #${id}: ${name}`);
  units.push({id, name, status: 'Available', lat, lng, marker});
  renderUnits();
}

function assignUnit(callId) {
  const unitId = prompt("Enter Unit ID to assign:");
  const unit = units.find(u => u.id == unitId);
  if(unit) {
    const call = calls.find(c => c.id == callId);
    call.assigned = unit.name;
    call.status = 'En Route';
    unit.status = 'Busy';
    renderUnits();
    renderCalls();
    // Move unit marker to call location
    unit.marker.setLatLng([call.lat, call.lng]).bindPopup(`${unit.name} assigned to Call #${call.id}`).openPopup();
  }
}

function closeCall(callId) {
  const call = calls.find(c => c.id == callId);
  call.status = 'Closed';
  const unit = units.find(u => u.name === call.assigned);
  if(unit) {
    unit.status = 'Available';
    unit.marker.bindPopup(`${unit.name} is available`);
  }
  renderUnits();
  renderCalls();
}

function addBolo() {
  const description = prompt("Enter BOLO/Warrant description:");
  if(!description) return;
  const id = bolos.length + 1;
  bolos.push({id, description, status: 'Active'});
  renderBolos();
}

function renderCalls() {
  const tbody = document.querySelector('#callsTable tbody');
  tbody.innerHTML = '';
  calls.forEach(c => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${c.id}</td><td>${c.type}</td><td>${c.location}</td><td>${c.status}</td>
    <td>${c.assigned || '<button onclick="assignUnit('+c.id+')">Assign</button>'}</td>
    <td><button onclick="closeCall(${c.id})">Close</button></td>`;
    tbody.appendChild(row);
  });
}

function renderUnits() {
  const tbody = document.querySelector('#unitsTable tbody');
  tbody.innerHTML = '';
  units.forEach(u => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${u.id}</td>
      <td><input class="unitName" value="${u.name}" onchange="changeUnitName(${u.id}, this.value)"></td>
      <td>${u.status}</td>`;
    tbody.appendChild(row);
  });
}

function changeUnitName(id, newName) {
  const unit = units.find(u => u.id === id);
  if(unit) {
    unit.name = newName;
    if(unit.marker) unit.marker.bindPopup(`${unit.name}`).openPopup();
    renderCalls();
  }
}

function renderBolos() {
  const tbody = document.querySelector('#bolosTable tbody');
  tbody.innerHTML = '';
  bolos.forEach(b => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${b.id}</td><td>${b.description}</td><td>${b.status}</td>`;
    tbody.appendChild(row);
  });
}

// Initial render
renderCalls();
renderUnits();
renderBolos();
</script>

</body>
</html>
