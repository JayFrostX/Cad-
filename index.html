<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rockford City Police CAD</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
:root {
  --bg:#0f1720;
  --panel:#1f2a38;
  --text:white;
  --table:white;
}

.light {
  --bg:#f4f4f4;
  --panel:white;
  --text:black;
  --table:white;
}

body {
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}

/* BOOT */
#bootScreen {
  position:fixed;
  width:100%;
  height:100vh;
  background:linear-gradient(to right, #6ea0c9, #5c8fbb);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
  transition:opacity 0.5s ease;
}

.progressBar {
  width:500px;
  height:45px;
  border-radius:12px;
  border:3px solid #4e79a7;
  padding:6px;
  margin-bottom:20px;
}

.progressFill {
  height:100%;
  width:0%;
  background:#3d6ea5;
  border-radius:8px;
  transition:width 0.2s ease;
}

.bootText {
  font-size:28px;
  font-weight:bold;
  color:#3d6ea5;
  letter-spacing:2px;
}

/* LOGIN */
#loginPage {
  height:100vh;
  background:#0b2a57;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

#loginBox {
  background:#d9d9d9;
  padding:35px;
  width:420px;
  border-radius:4px;
  box-shadow:0 0 30px rgba(0,0,0,0.5);
}

#loginBox input {
  width:100%;
  padding:10px;
  margin:8px 0;
}

#loginBox button {
  width:100%;
  padding:10px;
  background:#2f4f9e;
  color:white;
  border:none;
  cursor:pointer;
}

/* CAD */
#cadSystem {
  display:none;
  height:100vh;
  flex-direction:row;
}

#sidebar {
  width:260px;
  background:var(--panel);
  padding:15px;
}

#main {
  flex:1;
  display:flex;
  flex-direction:column;
}

.section {
  flex:1;
  overflow:auto;
  padding:10px;
  display:none;
}

.section.active { display:block; }

table {
  width:100%;
  border-collapse:collapse;
  background:var(--table);
  color:black;
}

th, td {
  border:1px solid #ccc;
  padding:6px;
}

.deleteBtn {
  background:red;
  color:white;
  padding:4px 8px;
  cursor:pointer;
}

#chatContainer {
  height:40%;
  display:flex;
  flex-direction:column;
  border-top:2px solid #ccc;
}

#messages {
  flex:1;
  overflow:auto;
  padding:10px;
  background:#ddd;
  color:black;
}

#chatInputArea { display:flex; }
#chatInput { flex:1; }
</style>
</head>

<body>

<!-- BOOT -->
<div id="bootScreen">
  <div>
    <div class="progressBar">
      <div class="progressFill" id="progressFill"></div>
    </div>
    <div class="bootText">STARTING...</div>
  </div>
</div>

<!-- LOGIN -->
<div id="loginPage">
  <div id="loginBox">
    <h2>Rockford Police CAD</h2>
    <input id="loginUser" placeholder="Username">
    <input type="password" id="loginPass" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- CAD -->
<div id="cadSystem">
  <div id="sidebar">
    <h3>Rockford City</h3>
    <button onclick="showSection('calls')">Calls</button>
    <button onclick="showSection('units')">Units</button>
    <button onclick="showSection('warrants')">Warrants</button>
    <button onclick="showSection('arrests')">Arrests</button>
    <button onclick="toggleTheme()">Toggle Theme</button>
  </div>

  <div id="main">

    <div id="calls" class="section active">
      <h3>Calls</h3>
      <button onclick="addCall()">Add</button>
      <table>
        <thead><tr><th>ID</th><th>Type</th><th>Location</th><th>Delete</th></tr></thead>
        <tbody id="callsBody"></tbody>
      </table>
    </div>

    <div id="units" class="section">
      <h3>Units</h3>
      <button onclick="addUnit()">Add</button>
      <table>
        <thead><tr><th>ID</th><th>Name</th><th>Delete</th></tr></thead>
        <tbody id="unitsBody"></tbody>
      </table>
    </div>

    <div id="warrants" class="section">
      <h3>Warrants</h3>
      <button onclick="addWarrant()">Add</button>
      <table>
        <thead><tr><th>ID</th><th>Name</th><th>Reason</th><th>Delete</th></tr></thead>
        <tbody id="warrantsBody"></tbody>
      </table>
    </div>

    <div id="arrests" class="section">
      <h3>Arrests</h3>
      <button onclick="addArrest()">Add</button>
      <table>
        <thead><tr><th>ID</th><th>Name</th><th>Reason</th><th>Delete</th></tr></thead>
        <tbody id="arrestsBody"></tbody>
      </table>
    </div>

    <div id="chatContainer">
      <div id="messages"></div>
      <div id="chatInputArea">
        <input id="chatInput" placeholder="Message...">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

  </div>
</div>

<script>

/* BOOT */
window.onload = function(){
  const fill = document.getElementById("progressFill");
  let width = 0;
  const interval = setInterval(() => {
    width += 10;
    fill.style.width = width + "%";
    if(width >= 100){
      clearInterval(interval);
      setTimeout(() => {
        document.getElementById("bootScreen").style.display="none";
      },400);
    }
  },200);
};

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAtbzUhg8vT040z9iNEakF_kqEvr7YkPM4",
  authDomain: "police-cad-86ba9.firebaseapp.com",
  databaseURL: "https://police-cad-86ba9-default-rtdb.firebaseio.com",
  projectId: "police-cad-86ba9"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* REFERENCES */
const callsRef = db.ref("calls");
const unitsRef = db.ref("units");
const warrantsRef = db.ref("warrants");
const arrestsRef = db.ref("arrests");
const chatRef = db.ref("chat");

let currentUser="";

/* LOGIN */
function login(){
  const user=document.getElementById("loginUser").value.trim();
  currentUser=user||"Officer";
  document.getElementById("loginPage").style.display="none";
  document.getElementById("cadSystem").style.display="flex";
}

/* SECTIONS */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function toggleTheme(){ document.body.classList.toggle("light"); }

/* CALLS */
function addCall(){
  const type=prompt("Type:");
  const loc=prompt("Location:");
  if(!type||!loc)return;
  callsRef.push({type,loc});
}

callsRef.on("value", snap=>{
  callsBody.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    const key=child.key;
    callsBody.innerHTML+=`
    <tr>
      <td>${key}</td>
      <td>${data.type}</td>
      <td>${data.loc}</td>
      <td><button class="deleteBtn" onclick="callsRef.child('${key}').remove()">X</button></td>
    </tr>`;
  });
});

/* UNITS */
function addUnit(){
  const name=prompt("Name:");
  if(!name)return;
  unitsRef.push({name});
}

unitsRef.on("value", snap=>{
  unitsBody.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    const key=child.key;
    unitsBody.innerHTML+=`
    <tr>
      <td>${key}</td>
      <td>${data.name}</td>
      <td><button class="deleteBtn" onclick="unitsRef.child('${key}').remove()">X</button></td>
    </tr>`;
  });
});

/* WARRANTS */
function addWarrant(){
  const name=prompt("Name:");
  const reason=prompt("Reason:");
  if(!name||!reason)return;
  warrantsRef.push({name,reason});
}

warrantsRef.on("value", snap=>{
  warrantsBody.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    const key=child.key;
    warrantsBody.innerHTML+=`
    <tr>
      <td>${key}</td>
      <td>${data.name}</td>
      <td>${data.reason}</td>
      <td><button class="deleteBtn" onclick="warrantsRef.child('${key}').remove()">X</button></td>
    </tr>`;
  });
});

/* ARRESTS */
function addArrest(){
  const name=prompt("Name:");
  const reason=prompt("Reason:");
  if(!name||!reason)return;
  arrestsRef.push({name,reason});
}

arrestsRef.on("value", snap=>{
  arrestsBody.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    const key=child.key;
    arrestsBody.innerHTML+=`
    <tr>
      <td>${key}</td>
      <td>${data.name}</td>
      <td>${data.reason}</td>
      <td><button class="deleteBtn" onclick="arrestsRef.child('${key}').remove()">X</button></td>
    </tr>`;
  });
});

/* CHAT */
function sendMessage(){
  const text=document.getElementById("chatInput").value.trim();
  if(!text)return;
  chatRef.push({user:currentUser,message:text});
  document.getElementById("chatInput").value="";
}

chatRef.on("child_added", snap=>{
  const data=snap.val();
  messages.innerHTML+=`<div><b>${data.user}:</b> ${data.message}</div>`;
  messages.scrollTop=messages.scrollHeight;
});
</script>

</body>
</html>
