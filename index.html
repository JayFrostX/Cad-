<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Police CAD</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; display: flex; height: 100vh; }
  #sidebar { width: 300px; background: #2c3e50; color: white; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
  #sidebar h2 { margin-top: 0; }
  #sidebar button { margin: 5px 0; padding: 10px; border: none; background: #34495e; color: white; cursor: pointer; }
  #sidebar button:hover { background: #1abc9c; }
  #main { flex: 1; display: flex; flex-direction: column; }

  /* Tables and content sections */
  #calls, #units, #bolos, #arrests, #warrants { flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #ccc; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
  input.unitName { width: 80%; }

  /* Chat area */
  #chatContainer {
    flex: 2;
    background: #f5f5f7;
    border-top: 1px solid #ccc;
    display: flex;
    flex-direction: column;
    padding: 10px;
    box-sizing: border-box;
  }
  #chatHeader { font-weight: bold; margin-bottom: 10px; }
  #chatMessages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background: white;
    border-radius: 8px;
    border: 1px solid #ccc;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .message { max-width: 80%; padding: 8px 12px; border-radius: 16px; background: #e1e1e1; align-self: flex-start; }
  .message.user { background: #1abc9c; color: white; align-self: flex-end; }
  #chatInputContainer { margin-top: 10px; display: flex; gap: 5px; }
  #chatInput { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
  #chatSend { padding: 10px 15px; border-radius: 20px; border: none; background: #1abc9c; color: white; cursor: pointer; }
  #chatSend:hover { background: #16a085; }
</style>
</head>
<body>

<div id="sidebar" style="display:none;">
  <h2>Police CAD</h2>
  <button onclick="showSection('calls')">Calls</button>
  <button onclick="showSection('units')">Units</button>
  <button onclick="showSection('bolos')">BOLOs</button>
  <button onclick="showSection('arrests')">Arrests</button>
  <button onclick="showSection('warrants')">Warrants</button>
</div>

<div id="main">
  <div id="calls">
    <h3>Active Calls</h3>
    <button onclick="addCall()">Add Call</button>
    <table id="callsTable">
      <thead><tr><th>ID</th><th>Type</th><th>Location</th><th>Status</th><th>Assign</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="units" style="display:none;">
    <h3>Units</h3>
    <button onclick="addUnit()">Add Unit</button>
    <table id="unitsTable">
      <thead><tr><th>ID</th><th>Name</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="bolos" style="display:none;">
    <h3>BOLOs / Warrants</h3>
    <button onclick="addBolo()">Add BOLO</button>
    <table id="bolosTable">
      <thead><tr><th>ID</th><th>Description</th><th>Status</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="arrests" style="display:none;">
    <h3>Arrests</h3>
    <button onclick="addArrest()">Add Arrest</button>
    <table id="arrestsTable">
      <thead><tr><th>ID</th><th>Name</th><th>Reason</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="warrants" style="display:none;">
    <h3>Arrest Warrants</h3>
    <button onclick="addWarrant()">Add Warrant</button>
    <table id="warrantsTable">
      <thead><tr><th>ID</th><th>Name</th><th>Reason</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="chatContainer">
    <div id="chatHeader">Community Chat</div>
    <div id="chatMessages"></div>
    <div id="chatInputContainer">
      <input id="chatInput" type="text" placeholder="Type a message..." />
      <button id="chatSend">Send</button>
    </div>
  </div>
</div>

<script>

  /* ---------------- Login Screen ---------------- */
#loginScreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #001a4d;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  color: white;
}

#loginHeader {
  position: absolute;
  top: 20px;
  width: 100%;
  text-align: center;
  font-size: 28px;
  font-weight: bold;
  letter-spacing: 2px;
}

#loginBox {
  background: #cfcfd4;
  color: black;
  padding: 20px;
  border: 2px solid #888;
  width: 320px;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

#loginBox h3 {
  margin-top: 0;
  background: #2f4f9f;
  color: white;
  padding: 5px;
  font-size: 14px;
}

.loginField {
  margin: 10px 0;
}

.loginField input {
  width: 100%;
  padding: 5px;
}

#loginBtn {
  width: 100%;
  padding: 8px;
  margin-top: 10px;
  background: #2f4f9f;
  color: white;
  border: none;
  cursor: pointer;
}
// ---------------- Sections ----------------
function showSection(section) {
  const sections = ['calls','units','bolos','arrests','warrants'];
  sections.forEach(s => document.getElementById(s).style.display = 'none');
  document.getElementById(section).style.display = 'block';
}

// ---------------- Data ----------------
let calls = [], units = [], bolos = [], arrests = [], warrants = [];
let idCounter = 1;

// ---------------- Calls ----------------
function renderCalls() {
  const tbody = document.querySelector('#callsTable tbody');
  tbody.innerHTML = '';
  calls.forEach(c => {
    tbody.innerHTML += `<tr>
      <td>${c.id}</td>
      <td>${c.type}</td>
      <td>${c.location}</td>
      <td>${c.status}</td>
      <td><input class="unitName" placeholder="Assign Unit"></td>
      <td><button onclick="deleteCall(${c.id})">Delete</button></td>
    </tr>`;
  });
}

function addCall() {
  const type = prompt("Call Type:");
  if(!type) return;
  const location = prompt("Location:");
  if(!location) return;
  calls.push({id: idCounter++, type, location, status: "Active"});
  renderCalls();
}

function deleteCall(id){
  calls = calls.filter(c=>c.id!==id);
  renderCalls();
}

// ---------------- Units ----------------
function renderUnits() {
  const tbody = document.querySelector('#unitsTable tbody');
  tbody.innerHTML = '';
  units.forEach(u => {
    tbody.innerHTML += `<tr>
      <td>${u.id}</td>
      <td>${u.name}</td>
      <td>${u.status}</td>
    </tr>`;
  });
}

function addUnit() {
  const name = prompt("Unit Name:");
  if(!name) return;
  units.push({id: idCounter++, name, status: "Available"});
  renderUnits();
}

// ---------------- BOLOs ----------------
function renderBolos() {
  const tbody = document.querySelector('#bolosTable tbody');
  tbody.innerHTML='';
  bolos.forEach(b=>{
    tbody.innerHTML+=`<tr>
      <td>${b.id}</td>
      <td>${b.description}</td>
      <td>${b.status}</td>
      <td><button onclick="deleteBolo(${b.id})">Delete</button></td>
    </tr>`;
  });
}

function addBolo() {
  const desc = prompt("BOLO Description:");
  if(!desc) return;
  bolos.push({id: idCounter++, description: desc, status:"Active"});
  renderBolos();
}

function deleteBolo(id){bolos=bolos.filter(b=>b.id!==id);renderBolos();}

// ---------------- Arrests ----------------
function renderArrests(){
  const tbody=document.querySelector('#arrestsTable tbody');
  tbody.innerHTML='';
  arrests.forEach(a=>{
    tbody.innerHTML+=`<tr>
      <td>${a.id}</td>
      <td>${a.name}</td>
      <td>${a.reason}</td>
      <td><button onclick="deleteArrest(${a.id})">Delete</button></td>
    </tr>`;
  });
}

function addArrest() {
  const name = prompt("Person Name:");
  if(!name) return;
  const reason = prompt("Reason:");
  if(!reason) return;
  arrests.push({id: idCounter++, name, reason});
  renderArrests();
}

function deleteArrest(id){arrests=arrests.filter(a=>a.id!==id);renderArrests();}

// ---------------- Warrants ----------------
function renderWarrants(){
  const tbody=document.querySelector('#warrantsTable tbody');
  tbody.innerHTML='';
  warrants.forEach(w=>{
    tbody.innerHTML+=`<tr>
      <td>${w.id}</td>
      <td>${w.name}</td>
      <td>${w.reason}</td>
      <td><button onclick="deleteWarrant(${w.id})">Delete</button></td>
    </tr>`;
  });
}

function addWarrant() {
  const name = prompt("Person Name:");
  if(!name) return;
  const reason = prompt("Reason:");
  if(!reason) return;
  warrants.push({id: idCounter++, name, reason});
  renderWarrants();
}

function deleteWarrant(id){warrants=warrants.filter(w=>w.id!==id);renderWarrants();}

// ---------------- WebSocket Chat ----------------
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const chatSend = document.getElementById("chatSend");

// Random username per tab
const username = "Officer" + Math.floor(Math.random() * 1000);

// Connect to WebSocket server
const ws = new WebSocket(`ws://${window.location.hostname}:3000`);

ws.onmessage = (event) => {
  try {
    const data = JSON.parse(event.data);
    if(data.type === 'chat') {
      addMessage(data.sender, data.text);
    }
  } catch (err) { console.error(err); }
};

function addMessage(sender, text) {
  const message = document.createElement("div");
  message.classList.add("message");
  if(sender === username) message.classList.add("user");
  message.textContent = `${sender}: ${text}`;
  chatMessages.appendChild(message);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

chatSend.addEventListener("click", () => {
  const text = chatInput.value.trim();
  if(!text) return;
  ws.send(JSON.stringify({ type:'chat', sender: username, text }));
  chatInput.value = "";
});

chatInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") chatSend.click();
});
</script>
</body>
  <!-- Login Screen -->
<div id="loginScreen">
  <div id="loginHeader">
    ROCKFORD CITY POLICE DEPT<br>
    <span style="font-size:14px;">Protecting Rockford City</span>
  </div>

  <div id="loginBox">
    <h3>RCPD - We see it all. We know it all.</h3>
    <div>Please login to use this terminal.</div>

    <div class="loginField">
      Username:
      <input id="loginUsername" type="text">
    </div>

    <div class="loginField">
      Password:
      <input id="loginPassword" type="password">
    </div>

    <button id="loginBtn">Login</button>
  </div>
</div>
</html>
