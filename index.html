<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>State CAD System</title>

<style>
body {
    margin: 0;
    font-family: Arial;
    background: #0f172a;
    color: #e5e7eb;
}

.hidden { display: none; }

.card {
    background: #111827;
    padding: 20px;
    border-radius: 6px;
    width: 300px;
}

#loginScreen {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.topbar {
    background: #111827;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
}

.layout { display: flex; }

.sidebar {
    width: 200px;
    background: #020617;
    min-height: 100vh;
}

.sidebar button {
    width: 100%;
    background: none;
    border: none;
    color: white;
    padding: 12px;
    text-align: left;
    cursor: pointer;
}

.main { flex: 1; padding: 20px; }

input, select {
    margin: 5px;
    padding: 6px;
    background: #020617;
    border: 1px solid #1f2937;
    color: white;
}

button.action {
    background: #2563eb;
    border: none;
    padding: 6px 10px;
    color: white;
    cursor: pointer;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
    <div class="card">
        <h2>CAD Login</h2>
        <input id="username" placeholder="Username"><br>

        <select id="role">
            <option>Dispatcher</option>
            <option>Officer</option>
            <option>Supervisor</option>
        </select><br>

        <button class="action" onclick="login()">Login</button>
    </div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="topbar">
    <div>State CAD</div>
    <div id="userInfo"></div>
</div>

<div class="layout">
    <div class="sidebar">
        <button onclick="showPage('dashboard')">Dashboard</button>
        <button onclick="showPage('calls')">Calls</button>
        <button onclick="showPage('units')">Units</button>
    </div>

    <div class="main">

        <div id="dashboard" class="page">
            <h2>Dashboard</h2>
            Active Calls: <span id="callCount">0</span><br>
            Available Units: <span id="availableUnits">0</span>
        </div>

        <div id="calls" class="page hidden">
            <h2>Calls</h2>
            <input id="callType" placeholder="Type">
            <input id="callLocation" placeholder="Location">
            <button class="action" onclick="createCall()">Create</button>
            <table id="callTable"></table>
        </div>

        <div id="units" class="page hidden">
            <h2>Units</h2>
            <input id="unitName" placeholder="Unit ID">
            <button class="action" onclick="addUnit()">Add</button>
            <table id="unitTable"></table>
        </div>

    </div>
</div>
</div>

<script>
"use strict";

let data = JSON.parse(localStorage.getItem("cadData")) || {
    calls: [],
    units: []
};

function save(){
    localStorage.setItem("cadData", JSON.stringify(data));
}

/* LOGIN */
function login(){
    const name = document.getElementById("username").value.trim();
    const role = document.getElementById("role").value;

    if(!name){
        alert("Enter username");
        return;
    }

    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("userInfo").innerText = name + " (" + role + ")";

    renderAll();
}

/* NAV */
function showPage(id){
    document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}

/* CALLS */
function createCall(){
    const type = document.getElementById("callType").value;
    const loc = document.getElementById("callLocation").value;
    if(!type || !loc) return;

    data.calls.push({ id: Date.now(), type, location: loc });
    save();
    renderCalls();
}

function renderCalls(){
    const table = document.getElementById("callTable");
    table.innerHTML = "<tr><th>ID</th><th>Type</th><th>Location</th></tr>";

    data.calls.forEach(c=>{
        table.innerHTML += `<tr>
            <td>${c.id}</td>
            <td>${c.type}</td>
            <td>${c.location}</td>
        </tr>`;
    });

    document.getElementById("callCount").innerText = data.calls.length;
}

/* UNITS */
function addUnit(){
    const id = document.getElementById("unitName").value;
    if(!id) return;

    data.units.push({ id, status:"Available" });
    save();
    renderUnits();
}

function renderUnits(){
    const table = document.getElementById("unitTable");
    table.innerHTML = "<tr><th>Unit</th><th>Status</th></tr>";

    data.units.forEach(u=>{
        table.innerHTML += `<tr>
            <td>${u.id}</td>
            <td>${u.status}</td>
        </tr>`;
    });

    document.getElementById("availableUnits").innerText =
        data.units.filter(u=>u.status==="Available").length;
}

function renderAll(){
    renderCalls();
    renderUnits();
}
</script>

</body>
</html>
